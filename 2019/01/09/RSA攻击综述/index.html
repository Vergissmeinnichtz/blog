<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="CTF,Crypto,">





  <link rel="alternate" href="/atom.xml" title="Ver" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="简介RSA作为密码学中的代表，就和web中的php一样，被许多人不断研究，才有着今天这样广泛的使用程度。当然与此相对的也有许多的攻击方式被不断挖掘出来。这篇文章主要是对现阶段主流的RSA攻击方式进行总结，并配上exp脚本，以备以后的使用。">
<meta name="keywords" content="CTF,Crypto">
<meta property="og:type" content="article">
<meta property="og:title" content="RSA攻击综述">
<meta property="og:url" content="http://yoursite.com/2019/01/09/RSA攻击综述/index.html">
<meta property="og:site_name" content="Ver">
<meta property="og:description" content="简介RSA作为密码学中的代表，就和web中的php一样，被许多人不断研究，才有着今天这样广泛的使用程度。当然与此相对的也有许多的攻击方式被不断挖掘出来。这篇文章主要是对现阶段主流的RSA攻击方式进行总结，并配上exp脚本，以备以后的使用。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/7.jpg">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/1.jpg">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/2.jpg">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/3.png">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/4.jpg">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/5.jpg">
<meta property="og:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/6.jpg">
<meta property="og:updated_time" content="2019-08-06T04:20:45.138Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RSA攻击综述">
<meta name="twitter:description" content="简介RSA作为密码学中的代表，就和web中的php一样，被许多人不断研究，才有着今天这样广泛的使用程度。当然与此相对的也有许多的攻击方式被不断挖掘出来。这篇文章主要是对现阶段主流的RSA攻击方式进行总结，并配上exp脚本，以备以后的使用。">
<meta name="twitter:image" content="http://yoursite.com/2019/01/09/RSA攻击综述/7.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/01/09/RSA攻击综述/">





  <title>RSA攻击综述 | Ver</title>
  














</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ver</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/09/RSA攻击综述/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vergissmeinnicht">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ver">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RSA攻击综述</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-09T21:48:36+08:00">
                2019-01-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Crypto/" itemprop="url" rel="index">
                    <span itemprop="name">Crypto</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>RSA作为密码学中的代表，就和web中的php一样，被许多人不断研究，才有着今天这样广泛的使用程度。当然与此相对的也有许多的攻击方式被不断挖掘出来。这篇文章主要是对现阶段主流的RSA攻击方式进行总结，并配上exp脚本，以备以后的使用。<br><a id="more"></a></p>
<hr>
<h1 id="基本解法"><a href="#基本解法" class="headerlink" title="基本解法"></a>基本解法</h1><p>首先介绍的是RSA通常解法，也就是已知p,q,e和ciphertext的时候求d和plaintext</p>
<p>脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"素数p："</span></span><br><span class="line">p = input ()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"素数q："</span></span><br><span class="line">q = input ()</span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"公钥e："</span></span><br><span class="line">e = input ()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"密文ciphertext："</span></span><br><span class="line">ciphertext = input ()</span><br><span class="line"><span class="comment"># d=invert(e,φ(n))，可见invert()函数解决 ed ≡ 1 (mod φ(n)) 问题</span></span><br><span class="line">d=gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"私钥d："</span>,d</span><br><span class="line"></span><br><span class="line">plaintext=pow(ciphertext, d, n)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"明文："</span>,plaintext</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="对模数n的因子分解"><a href="#对模数n的因子分解" class="headerlink" title="对模数n的因子分解"></a>对模数n的因子分解</h1><h2 id="1-基本分解"><a href="#1-基本分解" class="headerlink" title="1.基本分解"></a>1.基本分解</h2><p>分解模数n是最直接的攻击方法，将n分解之后得到p,q，再通过p,q,e计算得到d，最后用d和n以及ciphertext求解plaintext<br>分解模数n可以通过<a href="https://sourceforge.net/projects/yafu/" target="_blank" rel="noopener">yafu</a>或者<a href="http://www.factordb.com" target="_blank" rel="noopener">factordb网站</a>在线分解，之后使用常规解法求解即可</p>
<h2 id="2-Pollard-Rho"><a href="#2-Pollard-Rho" class="headerlink" title="2.Pollard Rho"></a>2.Pollard Rho</h2><blockquote>
<p>rho算法其实是一种概率上的算法，虽然是靠概率，但是其准确率非常高（99.9%），更重要的是，该算法效率极高。其主要基于密码学当中的一个“生日悖论“来进行算法的设计。简单来讲就是，我们将N的两个因子x和y（就假设它有两个）从一大堆数里挑出来的概率非常小，但是如果我们挑满足x-y等于某个数的话，概率就要大很多。更进一步，如果我们找gcd(|x-y| ,N)呢？那么概率就会更大，就是这么个道理。<br>关于Rho算法，要注意有可能会进入死循环，也就是说我们要在算法中对其进行判圈，具体的做法是，每次a=f(a)，再找一个b=f(f(b))，如果有一个时刻a=b那么就退出循环，因为b是以两倍的速度走得，当b追上了a，那么b至少已经走完一圈了。</p>
</blockquote>
<p>脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        t = b</span><br><span class="line">        b = a % b</span><br><span class="line">        a = t</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Pollard_Rho</span><span class="params">(num)</span>:</span></span><br><span class="line">    y = <span class="number">2</span></span><br><span class="line">    x = <span class="number">2</span></span><br><span class="line">    factor = <span class="number">1</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> num==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> num % <span class="number">2</span> ==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> factor == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> count %<span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">print</span> count</span><br><span class="line">                x = (x*x + <span class="number">1</span>) % num</span><br><span class="line">                y = (((y*y + <span class="number">1</span>) % num) ^ <span class="number">2</span> + <span class="number">1</span>) % num</span><br><span class="line">                factor = gcd( abs(x - y), num )</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> factor</span><br><span class="line"></span><br><span class="line">n = xxx</span><br><span class="line"></span><br><span class="line">res = Pollard_Rho(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (res)</span><br></pre></td></tr></table></figure></p>
<h2 id="3-Pollard-P-1"><a href="#3-Pollard-P-1" class="headerlink" title="3.Pollard P-1"></a>3.Pollard P-1</h2><blockquote>
<p>这种方法是在p-1的素数分解式中不含有大于预定B值的素因数的情况下，找到一个基本的素数p，求出一个数的素因数。方法有点特殊，它只能应用在求整数n的一个素因子p，且p-1能被“小”因子整除的情况下，除此之外该方法无法正常应用。但是这个方法运用起来相当简单，所以在防止因式分解攻击时，必须考虑这一方法</p>
</blockquote>
<p>脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pollard's p-1 algorithm</span></span><br><span class="line"><span class="comment"># https://en.wikipedia.org/wiki/Pollard%27s_p_%E2%88%92_1_algorithm</span></span><br><span class="line"><span class="comment"># this is really slow on stock python2, use either python3 or some JITer</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        t = b</span><br><span class="line">        b = a % b</span><br><span class="line">        a = t</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = <span class="number">2</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">if</span> b % <span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">            print(b)</span><br><span class="line">            </span><br><span class="line">        a = pow(a, b, n)</span><br><span class="line">            </span><br><span class="line">        p = gcd(a - <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt; p &lt; n:</span><br><span class="line">            print(<span class="string">"FOUND "</span> + str(p))</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">            </span><br><span class="line">        b += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">n = xxx</span><br><span class="line">p = factor(n)</span><br><span class="line">print(<span class="string">"p"</span>,p)</span><br></pre></td></tr></table></figure></p>
<h3 id="例题-ASIS-CTF-Finals-2017-Handicraft-RSA"><a href="#例题-ASIS-CTF-Finals-2017-Handicraft-RSA" class="headerlink" title="例题:ASIS-CTF-Finals-2017 Handicraft_RSA"></a>例题:ASIS-CTF-Finals-2017 Handicraft_RSA</h3><p>题目可以提取出加密脚本：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> s, FLAG</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_prime</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        r = getPrime(s)</span><br><span class="line">        R = [r]</span><br><span class="line">        t = int(<span class="number">5</span> * s / <span class="number">2</span>) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, t):</span><br><span class="line">            R.append(r + getRandomRange(<span class="number">0</span>, <span class="number">4</span> * s ** <span class="number">2</span>))</span><br><span class="line">        p = reduce(<span class="keyword">lambda</span> a, b: a * b, R, <span class="number">2</span>) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">if</span> len(bin(p)[<span class="number">2</span>:]) == <span class="number">1024</span>:</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    p = gen_prime(s)</span><br><span class="line">    q = gen_prime(s)</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    d = inverse(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">if</span> len(bin(n)[<span class="number">2</span>:]) == <span class="number">2048</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">msg = FLAG</span><br><span class="line">key = RSA.construct((long(n), long(e), long(d), long(p), long(p)))</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> xrange(s):</span><br><span class="line">    enc = key.encrypt(msg, <span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">    msg = enc</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> key.publickey().exportKey()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'-'</span> * <span class="number">76</span></span><br><span class="line"><span class="keyword">print</span> enc.encode(<span class="string">'base64'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'-'</span> * <span class="number">76</span></span><br></pre></td></tr></table></figure></p>
<p>以及一些output</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq+m7iHurBa9G8ujEiTpZ</span><br><span class="line">71aHOVNhQXpd6jCQNhwMN3hD6JHkv0HSxmJwfGe0EnXDtjRraWmS6OYzT4+LSrXs</span><br><span class="line">z9IkWGzRlJ4lC7WHS8D3NWIWYHCP4TRt2N0TlWXWm9nFCrEXqQ3IWgYQpQvKzsds</span><br><span class="line">etnIZJL1tf1wQzGE6rbkbvURlUBbzBSuidkmi0kY5Qxp2Jfb6OUI647zx2dPxJpD</span><br><span class="line">ffSCNffVIDUYOvrgYxIhs5HmCF3XECC3VfaKtRceL5JM8R0qz5nVU2Ns8hPvSVP+</span><br><span class="line">7/i7G447cjW151si0joB7RpBplu44Vk8TXXDAk0JZdW6KwJn7ITaX04AAAAAAAAA</span><br><span class="line">AQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line">eER0JNIcZYx/t+7lnRvv8s8zyMw8dYspZlne0MQUatQNcnDL/wnHtkAoNdCalQkpcbnZeAz4qeMX</span><br><span class="line">5GBmsO+BXyAKDueMA4uy3fw2k/dqFSsZFiB7I9M0oEkqUja52IMpkGDJ2eXGj9WHe4mqkniIayS4</span><br><span class="line">2o4p9b0Qlz754qqRgkuaKzPWkZPKynULAtFXF39zm6dPI/jUA2BEo5WBoPzsCzwRmdr6QmJXTsau</span><br><span class="line">5BAQC5qdIkmCNq7+NLY1fjOmSEF/W+mdQvcwYPbe2zezroCiLiPNZnoABfmPbWAcASVU6M0YxvnX</span><br><span class="line">sh2YjkyLFf4cJSgroM3Aw4fVz3PPSsAQyCFKBA==</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>解题脚本:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        t = b</span><br><span class="line">        b = a % b</span><br><span class="line">        a = t</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pollard's p-1 algorithm</span></span><br><span class="line"><span class="comment"># https://en.wikipedia.org/wiki/Pollard%27s_p_%E2%88%92_1_algorithm</span></span><br><span class="line"><span class="comment"># this is really slow on stock python2, use either python3 or some JITer</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = <span class="number">2</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">if</span> b % <span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">            print(b)</span><br><span class="line">            </span><br><span class="line">        a = pow(a, b, n)</span><br><span class="line">            </span><br><span class="line">        p = gcd(a - <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt; p &lt; n:</span><br><span class="line">            print(<span class="string">"FOUND "</span> + str(p))</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">            </span><br><span class="line">        b += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(n, p, q)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> p * q == n</span><br><span class="line"></span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    d = inverse(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line">    key = RSA.construct((long(n), long(e), long(d), long(p), long(q)))</span><br><span class="line">    msg = base64.b64decode(<span class="string">"eER0JNIcZYx/t+7lnRvv8s8zyMw8dYspZlne0MQUatQNcnDL/wnHtkAoNdCalQkpcbnZeAz4qeMX5GBmsO+BXyAKDueMA4uy3fw2k/dqFSsZFiB7I9M0oEkqUja52IMpkGDJ2eXGj9WHe4mqkniIayS42o4p9b0Qlz754qqRgkuaKzPWkZPKynULAtFXF39zm6dPI/jUA2BEo5WBoPzsCzwRmdr6QmJXTsau5BAQC5qdIkmCNq7+NLY1fjOmSEF/W+mdQvcwYPbe2zezroCiLiPNZnoABfmPbWAcASVU6M0YxvnXsh2YjkyLFf4cJSgroM3Aw4fVz3PPSsAQyCFKBA=="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">20</span>):</span><br><span class="line">        enc = key.decrypt(msg)</span><br><span class="line">        msg = enc</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">print</span> repr(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">asciikey = <span class="string">"""-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq+m7iHurBa9G8ujEiTpZ</span></span><br><span class="line"><span class="string">71aHOVNhQXpd6jCQNhwMN3hD6JHkv0HSxmJwfGe0EnXDtjRraWmS6OYzT4+LSrXs</span></span><br><span class="line"><span class="string">z9IkWGzRlJ4lC7WHS8D3NWIWYHCP4TRt2N0TlWXWm9nFCrEXqQ3IWgYQpQvKzsds</span></span><br><span class="line"><span class="string">etnIZJL1tf1wQzGE6rbkbvURlUBbzBSuidkmi0kY5Qxp2Jfb6OUI647zx2dPxJpD</span></span><br><span class="line"><span class="string">ffSCNffVIDUYOvrgYxIhs5HmCF3XECC3VfaKtRceL5JM8R0qz5nVU2Ns8hPvSVP+</span></span><br><span class="line"><span class="string">7/i7G447cjW151si0joB7RpBplu44Vk8TXXDAk0JZdW6KwJn7ITaX04AAAAAAAAA</span></span><br><span class="line"><span class="string">AQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----"""</span></span><br><span class="line"></span><br><span class="line">key = RSA.importKey(asciikey)</span><br><span class="line">n = int(key.n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = 139457081371053313087662621808811891689477698775602541222732432884929677435971504758581219546068100871560676389156360422970589688848020499752936702307974617390996217688749392344211044595211963580524376876607487048719085184308509979502505202804812382023512342185380439620200563119485952705668730322944000000001</span></span><br><span class="line">p = factor(key.n)</span><br><span class="line"></span><br><span class="line">q = n / p</span><br><span class="line"></span><br><span class="line">decrypt(n, p, q)</span><br></pre></td></tr></table></figure></p>
<h2 id="4-已知e-d分解n"><a href="#4-已知e-d分解n" class="headerlink" title="4.已知e,d分解n"></a>4.已知e,d分解n</h2><p>在有的时候会有两道连续的RSA题目，第二道题的n和第一题的一样，但e不一样，这个时候就可以通过这个方法求解第二题<br><a href="https://www.di-mgt.com.au/rsa_factorize_n.html" target="_blank" rel="noopener">参考资料</a><br>算法如下：</p>
<div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/7.jpg" alt="7"></div>

<p>实现代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">facN</span> <span class="params">(N,e,d)</span>:</span></span><br><span class="line">    k = e*d - <span class="number">1</span></span><br><span class="line">    t = k</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>,N<span class="number">-1</span>)</span><br><span class="line">        y = gcd(x<span class="number">-1</span>,N)</span><br><span class="line">        <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> y &gt; <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">'find!'</span>)</span><br><span class="line">            print(y)</span><br><span class="line">            print(N/y)</span><br><span class="line">            <span class="keyword">return</span> y,N/y</span><br><span class="line">        <span class="keyword">if</span> t % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            t = t/<span class="number">2</span></span><br><span class="line">            x = pow(g,t,N)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">	        t = k</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure></p>
<h3 id="例题-HITB-2017-Hack-in-the-card-II"><a href="#例题-HITB-2017-Hack-in-the-card-II" class="headerlink" title="例题:HITB-2017 Hack in the card II"></a>例题:HITB-2017 Hack in the card II</h3><p>WP参考<a href="https://tradahacking.vn/hitb-gsec-singapore-2017-ctf-write-ups-crypto-category-803d6c770103" target="_blank" rel="noopener">此篇文章</a><br>这道题的前一道相关题在本文章的<code>侧信道攻击</code>一栏的例题中<br>题目给出了新的公钥文件 publickey.pem和密文</p>
<p>密文<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">016d1d26a470fad51d52e5f3e90075ab77df69d2fb39905fe634ded81d10a5fd10c35e1277035a9efabb66e4d52fd2d1eaa845a93a4e0f1c4a4b70a0509342053728e89e977cfb9920d5150393fe9dcbf86bc63914166546d5ae04d83631594703db59a628de3b945f566bdc5f0ca7bdfa819a0a3d7248286154a6cc5199b99708423d0749d4e67801dff2378561dd3b0f10c8269dbef2630819236e9b0b3d3d8910f7f7afbbed29788e965a732efc05aef3194cd1f1cff97381107f2950c935980e8954f91ed2a653c91015abea2447ee2a3488a49cc9181a3b1d44f198ff9f0141badcae6a9ae45c6c75816836fb5f331c7f2eb784129a142f88b4dc22a0a977</span><br></pre></td></tr></table></figure></p>
<p>我们通过提取新的公钥文件中的N和e可以发现N没有变但是e变了，所以我们就可以通过前一题得到的N，e和d分解出p和q，然后算出新的d并解密密文</p>
<p>解题脚本如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a==<span class="number">0</span>:</span><br><span class="line">	    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        t = b</span><br><span class="line">        b = a % b</span><br><span class="line">        a = t</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">facN</span> <span class="params">(N,e,d)</span>:</span></span><br><span class="line">    k = e*d - <span class="number">1</span></span><br><span class="line">    t = k</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>,N<span class="number">-1</span>)</span><br><span class="line">        y = gcd(x<span class="number">-1</span>,N)</span><br><span class="line">        <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> y &gt; <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">'find!'</span>)</span><br><span class="line">            print(y)</span><br><span class="line">            print(N/y)</span><br><span class="line">            <span class="keyword">return</span> y,N/y</span><br><span class="line">        <span class="keyword">if</span> t % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            t = t/<span class="number">2</span></span><br><span class="line">            x = pow(g,t,N)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">	        t = k</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    </span><br><span class="line">m = <span class="number">0x16d1d26a470fad51d52e5f3e90075ab77df69d2fb39905fe634ded81d10a5fd10c35e1277035a9efabb66e4d52fd2d1eaa845a93a4e0f1c4a4b70a0509342053728e89e977cfb9920d5150393fe9dcbf86bc63914166546d5ae04d83631594703db59a628de3b945f566bdc5f0ca7bdfa819a0a3d7248286154a6cc5199b99708423d0749d4e67801dff2378561dd3b0f10c8269dbef2630819236e9b0b3d3d8910f7f7afbbed29788e965a732efc05aef3194cd1f1cff97381107f2950c935980e8954f91ed2a653c91015abea2447ee2a3488a49cc9181a3b1d44f198ff9f0141badcae6a9ae45c6c75816836fb5f331c7f2eb784129a142f88b4dc22a0a977</span></span><br><span class="line">n = <span class="number">0x17AE4F9BD4FF06B94C46DCBB7070070C7C23C4E8728BE3173CA815FCA5471C0BB35B19ED8838530ABB27D69B1C9D87229D0658D807D8EF74D732576DF4FBA9CD611FC768BE6047C52E8168A1C77E0E54D4877DC20A73FC3A2DB35DDE8700E79BAF61676BF6B6B27032E6B9F3A02F3FAAAFF36251BF2935D9CB45EFAC13D0974484C3D53C2A66A3D279D2B1B594F3797C0B8D33409161F7293EECB5287F45DA104020F0215BCC824338AD4A316E25E4A167A6E4928AF122FA0A55C4E55DEE01A4E0EED89F4B290BF79B5CAFE797AE4FA4B369E043AA0DFE91487E9054FF843EA249ED7945C8A911796F81A0F82EB5694A2FE2EBFF13A9E6DF3334FCAA1C63CBAC3</span></span><br><span class="line">e = <span class="number">0x14e9914b4cb427de38ac7956930f417ca8e46db1bb3fd343fef9825d467140aceb480dae5b164a7d2b0d2c5c4cbc2a3360409918173efee1d26f26b3020985bfb2675529710e6e61e4f3a960e9474ee5e14666f2fba26a535d73360242b2424e1a56a21e1c314da9b112444388767fa6cba8d94487382787d6c531fa2d131489605b161a09a5ca6999d479b2124a1f203907407ce1ac2f627ad8bc1911f66d9c4f2e2b974b43018a87b01bb8055b191d4a8f8dbd17ecbace3ec4b6f84b606830c282eb512cf51edf0a535bedda909cbf55c68a5ffca3c802def58ef9a0cbabd62d626f95fdc4eeb56d1d30ded03d81061c7093322bbd7b6ceb957a12583aa2625</span></span><br><span class="line">d1 = <span class="number">16390828876181053318339100750675858805085075693347294634845140223155300471343339735725090534836292007632963907771855159582051536368599877409046147073794159158745099750588781353203665310135991045663088765613847315146223892540146656146285947287434457737619192355597891759277954557284874079842576095414413634632218060041204741585014292743457235750761832960116264601238658366251628950826877369616205949504632422319118366206008416080422671942922507275909660907589263322598929672262664264325308446859589845055502830104300952306424775575141740987190395212323715203016486280360859837271948470735247258851655355384807804629939</span></span><br><span class="line">e1 = <span class="number">0x01583f58ca9230c4f8844c7f33d61983c27bf611947a1dce390073038805175b18f245543b61c6eaab46a572d03426476e9aecc34716cdac9e33f031f5381d18cf212a8191f826dd10e04fdb506ba9fd91e4831d8adc4c75aa2aa6132e7e48eac66d7ecf24428295eb1b7c64480cf170be83bcd853f9779e6df5999c2beef838d2f0c4d8fc4d9c8e4c6c37259446689ec30634bcd68f293c58cd44039be6299f92649620d6e6017dfd6007d1bd012df7cabec459e0e983f17b5051af4a4fca5cc71cdd72a6f4808e73f833917c2f54801bd9a06e3599edb9a62936764ce084dbf555c16f9e4781ead6fd39792476c6dfc0dd05ada281f75111efd7528065d9e35b</span></span><br><span class="line">p , q = facN(n,e1,d1)</span><br><span class="line">d=gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line">t=pow(m, d, n)</span><br><span class="line"><span class="comment">#t = '484954427b7468657920736179207468617420686973746f7279206973207772697474656e2062792074686520766963746f72737d'</span></span><br><span class="line"><span class="keyword">print</span> hex(t)[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="公共模数攻击"><a href="#公共模数攻击" class="headerlink" title="公共模数攻击"></a>公共模数攻击</h1><p>公共模数就是指用相同的n加密同一段密文，这样做是十分危险的，因为我们可以利用数学推导绕过d直接得到明文。具体的推导如下：<br>我们假设m为信息明文，两个加密公钥分别为e1和e2，公共模数是n，则有<br>$$C_1\equiv m^{e1} mod(n)$$<br>$$C_2\equiv m^{e2} mod(n)$$</p>
<p>因为e1与e2互质，故我们用欧几里得算法能够找到s1和s2满足下面的关系<br>$$e_1^{s1}+e_2^{s2}=1$$</p>
<p>式中的s1和s2皆为整数，但是一正一负。我们假设s1为正数，s2为负数<br>因为<br>$$C_1\equiv m^{e1} mod(n)$$<br>$$C_2\equiv m^{e2} mod(n)$$</p>
<p>所以<br>$$(C_1^{s1}\times C_2^{s2}) mod(n) = ((m^{e1} mod(n))^{s1}\times (m^{e2} mod(n))^{s2}) mod(n)$$</p>
<p>根据模运算性质，可以化简为<br>$$(C_1^{s1}\times C_2^{s2}) mod(n) = ((m^{e1})^{s1}\times (m^{e2})^{s2}) mod(n)$$</p>
<p>即<br>$$(C_1^{s1}\times C_2^{s2}) mod(n) = (m^{e1^{s1}+e2^{s2}}) mod(n)$$</p>
<p>又因为前面提到过<br>$$e_1^{s1}+e_2^{s2}=1$$</p>
<p>所以<br>$$(C_1^{s1}\times C_2^{s2}) mod(n) = (m^1) mod(n)$$</p>
<p>即<br>$$C_1^{s1}\times C_2^{s2} = m$$</p>
<p>这样我们就可以通过c1,c2,e1和e2得到密文了<br>脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="comment">#可以使用libnum包中的n2s或者自己写一个</span></span><br><span class="line"><span class="comment">#from libnum import n2s</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n2s</span><span class="params">(num)</span>:</span></span><br><span class="line">    t = hex(num)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> len(t) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">'0'</span>+t).decode(<span class="string">'hex'</span>)</span><br><span class="line">    <span class="keyword">return</span> t.decode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#欧几里得算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    g, y, x = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"模数n："</span></span><br><span class="line">    n = input ()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"密文C1："</span></span><br><span class="line">    c1 = input ()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"密文C2："</span></span><br><span class="line">    c2 = input ()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"公钥e1："</span></span><br><span class="line">    e1 = input ()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"公钥e2："</span></span><br><span class="line">    e2 = input ()</span><br><span class="line">    s = egcd(e1, e2)</span><br><span class="line">    s1 = s[<span class="number">1</span>]</span><br><span class="line">    s2 = s[<span class="number">2</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#求模反元素</span></span><br><span class="line">    <span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">        s1 = - s1</span><br><span class="line">        c1 = invert(c1, n)</span><br><span class="line">    <span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">        s2 = - s2</span><br><span class="line">        c2 = invert(c2, n)</span><br><span class="line"></span><br><span class="line">    m = pow(c1,s1,n)*pow(c2,s2,n) % n</span><br><span class="line">    <span class="keyword">print</span> n2s(m)</span><br></pre></td></tr></table></figure></p>
<p>当然还有<a href="https://www.jianshu.com/p/2d95bdd0fb0d" target="_blank" rel="noopener">这种类型</a>的共模攻击,脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys,gmpy,base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(a, m)</span>:</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'modular inverse does not exist'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad_even</span><span class="params">(x)</span>:</span><span class="comment">#重要！凑齐2位，将0x1 变成 0x01</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">''</span>, <span class="string">'0'</span>)[len(x)%<span class="number">2</span>] + x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CipherB2n</span><span class="params">(c)</span>:</span><span class="comment">#将base64编码后的密文转成数字</span></span><br><span class="line">    c2 = base64.b64decode(c)</span><br><span class="line">    temp = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> c2:</span><br><span class="line">        temp += pad_even(str(hex(ord(i)))[<span class="number">2</span>:])</span><br><span class="line">    temp = eval(<span class="string">'0x'</span>+temp)</span><br><span class="line">    <span class="keyword">return</span> (temp)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CipherN2b</span><span class="params">(m)</span>:</span><span class="comment">#将数字转换成ascii</span></span><br><span class="line">    hex_m=hex(m)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> hex_m[<span class="number">-1</span>] == <span class="string">'L'</span> :</span><br><span class="line">        hex_m=hex_m[:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> hex_m.decode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    </span><br><span class="line">    sys.setrecursionlimit(<span class="number">1000000</span>)</span><br><span class="line">    e1 = <span class="number">2333</span> <span class="comment">#根据分解结果</span></span><br><span class="line">    e2 = <span class="number">23333</span> <span class="comment">#根据分解结果</span></span><br><span class="line">    s = egcd(e1, e2)</span><br><span class="line">    s1 = s[<span class="number">1</span>]</span><br><span class="line">    s2 = s[<span class="number">2</span>]</span><br><span class="line">    c1 = <span class="string">'XSKBJ2biS6brC5iGwU0GZitHdVM3HXAiwtFnVf2+HTaUqFahxL+BxBi2QDcx7gLxcjEWCMwFP6DS92nMAU4r0gPWSEUIoY57sgNZsjDIDAukiYeLNDUgYz+1P+nF4fk7gwPdozrIvAXGDBvMBjuviqsC8vmVP3I6eLLkt9C46HFt0SBw5ycfAjVoDF2r7/4B1UDs4G0dpIDUCk4khezzgqspn6tqtwOGB27vrKegoL/FlwmutFYIuRKKCBKx3yc/qfWXZ84Oo8nPqgaxgDlxWeLtGM9ZouwFKnagmjbnH+58Pescw4XYafXKqFjQz3XrK/uUESE8jIEIPeL1+8yUpw=='</span></span><br><span class="line">    c2 =<span class="string">'EruzwVAXSVLC3rldjcsx6HO0UUICdR9xxgr9eWNhIW0T8l2O3yT/LlFLK2+YU0HB97xr5HaiZesk4T6IuJ9+iOzB8YSkWMfYvOSDKn7Jng/1Q3wQuoldm+UurmZkiEs9kFi+EhsCNAbVAnLzLXLwzYm3emamueDqru4Doo/lSMz8p0+jqz24HscJN9shU85WX4JngW92REHHV8rPHaisCdxeAs+uPyTNzO4IbwDaJvw3ZR/Lo4m1K2Qw8PbYnOcgVr9CWR7mVyxofoWk6qWpQf3d0fX6wbbPcQkXxnnqLWy5S3PZcNQa1wkfRTJJO03QmNVsOivXGb3GzmeZbxmVhQ=='</span></span><br><span class="line">    c1 = CipherB2n(c1)</span><br><span class="line">    c2 = CipherB2n(c2)</span><br><span class="line">    <span class="comment">#print hex(c1)</span></span><br><span class="line">    n = <span class="number">17362520124149736059291605717839814089431261833972408175766504894876091272021197374480215582589878198406028065354454242540322618614670160317701698407729515781811530180885334265851364490357884909336085410775168953942120359215038925025305363480538685487988827339463890539279008285241711326041868183805848503077373967082910932422798165242481154593794712639251157856102009630894845049984346776659339380886766804814959778048440996937820138560802077375885700500737699904011032451007341777160586467318264288370080315519305800247682611802774996999330812534723806925426052547128371180683265963525581842037399869323246530085399</span> <span class="comment">#共n</span></span><br><span class="line">    <span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">        s1 = - s1</span><br><span class="line">        c1 = modinv(c1, n)</span><br><span class="line">    <span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">        s2 = - s2</span><br><span class="line">        c2 = modinv(c2, n)</span><br><span class="line">    m=(pow(c1,s1,n)*pow(c2,s2,n)) % n</span><br><span class="line">    <span class="keyword">print</span> m</span><br><span class="line">    <span class="keyword">print</span> CipherN2b(m)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="低加密指数广播攻击"><a href="#低加密指数广播攻击" class="headerlink" title="低加密指数广播攻击"></a>低加密指数广播攻击</h1><p>如果选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息，那么可以进行广播攻击得到明文。<br>即，选取了相同的加密指数e（这里取e=3），对相同的明文m进行了加密并进行了消息的传递，那么有：</p>
<p>$$C_1\equiv m^{e} mod(n_1)$$<br>$$C_2\equiv m^{e} mod(n_2)$$<br>$$C_3\equiv m^{e} mod(n_3)$$</p>
<p>对上述等式运用中国剩余定理，在e=3时，可以得到：</p>
<p>$$C_x\equiv m^{3} mod(n_1n_2n_3)$$</p>
<p>通过对Cx进行三次开方可以求得明文。</p>
<h2 id="例题-XCTF-4th-WHCTF-2017-OldDriver"><a href="#例题-XCTF-4th-WHCTF-2017-OldDriver" class="headerlink" title="例题:XCTF 4th-WHCTF-2017 OldDriver"></a>例题:XCTF 4th-WHCTF-2017 OldDriver</h2><p>题目给了如下信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;c&quot;: 7366067574741171461722065133242916080495505913663250330082747465383676893970411476550748394841437418105312353971095003424322679616940371123028982189502042, &quot;e&quot;: 10, &quot;n&quot;: 25162507052339714421839688873734596177751124036723831003300959761137811490715205742941738406548150240861779301784133652165908227917415483137585388986274803&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 21962825323300469151795920289886886562790942771546858500842179806566435767103803978885148772139305484319688249368999503784441507383476095946258011317951461, &quot;e&quot;: 10, &quot;n&quot;: 23976859589904419798320812097681858652325473791891232710431997202897819580634937070900625213218095330766877190212418023297341732808839488308551126409983193&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 6569689420274066957835983390583585286570087619048110141187700584193792695235405077811544355169290382357149374107076406086154103351897890793598997687053983, &quot;e&quot;: 10, &quot;n&quot;: 18503782836858540043974558035601654610948915505645219820150251062305120148745545906567548650191832090823482852604346478335353784501076761922605361848703623&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 4508246168044513518452493882713536390636741541551805821790338973797615971271867248584379813114125478195284692695928668946553625483179633266057122967547052, &quot;e&quot;: 10, &quot;n&quot;: 23383087478545512218713157932934746110721706819077423418060220083657713428503582801909807142802647367994289775015595100541168367083097506193809451365010723&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 22966105670291282335588843018244161552764486373117942865966904076191122337435542553276743938817686729554714315494818922753880198945897222422137268427611672, &quot;e&quot;: 10, &quot;n&quot;: 31775649089861428671057909076144152870796722528112580479442073365053916012507273433028451755436987054722496057749731758475958301164082755003195632005308493&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 17963313063405045742968136916219838352135561785389534381262979264585397896844470879023686508540355160998533122970239261072020689217153126649390825646712087, &quot;e&quot;: 10, &quot;n&quot;: 22246342022943432820696190444155665289928378653841172632283227888174495402248633061010615572642126584591103750338919213945646074833823905521643025879053949&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 1652417534709029450380570653973705320986117679597563873022683140800507482560482948310131540948227797045505390333146191586749269249548168247316404074014639, &quot;e&quot;: 10, &quot;n&quot;: 25395461142670631268156106136028325744393358436617528677967249347353524924655001151849544022201772500033280822372661344352607434738696051779095736547813043&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 15585771734488351039456631394040497759568679429510619219766191780807675361741859290490732451112648776648126779759368428205194684721516497026290981786239352, &quot;e&quot;: 10, &quot;n&quot;: 32056508892744184901289413287728039891303832311548608141088227876326753674154124775132776928481935378184756756785107540781632570295330486738268173167809047&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 8965123421637694050044216844523379163347478029124815032832813225050732558524239660648746284884140746788823681886010577342254841014594570067467905682359797, &quot;e&quot;: 10, &quot;n&quot;: 52849766269541827474228189428820648574162539595985395992261649809907435742263020551050064268890333392877173572811691599841253150460219986817964461970736553&#125;,</span><br><span class="line">&#123;&quot;c&quot;: 13560945756543023008529388108446940847137853038437095244573035888531288577370829065666320069397898394848484847030321018915638381833935580958342719988978247, &quot;e&quot;: 10, &quot;n&quot;: 30415984800307578932946399987559088968355638354344823359397204419191241802721772499486615661699080998502439901585573950889047918537906687840725005496238621&#125;]</span><br></pre></td></tr></table></figure></p>
<p>脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf8</span></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack,unpack</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> gmpy</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_parse_number</span><span class="params">(number)</span>:</span></span><br><span class="line">    string = <span class="string">"%x"</span> % number</span><br><span class="line">    <span class="comment">#if len(string) != 64:</span></span><br><span class="line">    <span class="comment">#    return ""</span></span><br><span class="line">    erg = []</span><br><span class="line">    <span class="keyword">while</span> string != <span class="string">''</span>:</span><br><span class="line">        erg = erg + [chr(int(string[:<span class="number">2</span>], <span class="number">16</span>))]</span><br><span class="line">        string = string[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(erg)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extended_gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    x,y = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    lastx, lasty = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, (q, b) = b, divmod(a,b)</span><br><span class="line">        x, lastx = lastx-q*x, x</span><br><span class="line">        y, lasty = lasty-q*y, y</span><br><span class="line">    <span class="keyword">return</span> (lastx, lasty, a)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chinese_remainder_theorem</span><span class="params">(items)</span>:</span></span><br><span class="line">  N = <span class="number">1</span></span><br><span class="line">  <span class="keyword">for</span> a, n <span class="keyword">in</span> items:</span><br><span class="line">    N *= n</span><br><span class="line">  result = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> a, n <span class="keyword">in</span> items:</span><br><span class="line">    m = N/n</span><br><span class="line">    r, s, d = extended_gcd(n, m)</span><br><span class="line">    <span class="keyword">if</span> d != <span class="number">1</span>:</span><br><span class="line">      N=N/n</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">      <span class="comment">#raise "Input not pairwise co-prime"</span></span><br><span class="line">    result += a*s*m</span><br><span class="line">  <span class="keyword">return</span> result % N, N</span><br><span class="line">sessions=[&#123;<span class="string">"c"</span>: <span class="number">7366067574741171461722065133242916080495505913663250330082747465383676893970411476550748394841437418105312353971095003424322679616940371123028982189502042</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">25162507052339714421839688873734596177751124036723831003300959761137811490715205742941738406548150240861779301784133652165908227917415483137585388986274803</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">21962825323300469151795920289886886562790942771546858500842179806566435767103803978885148772139305484319688249368999503784441507383476095946258011317951461</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">23976859589904419798320812097681858652325473791891232710431997202897819580634937070900625213218095330766877190212418023297341732808839488308551126409983193</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">6569689420274066957835983390583585286570087619048110141187700584193792695235405077811544355169290382357149374107076406086154103351897890793598997687053983</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">18503782836858540043974558035601654610948915505645219820150251062305120148745545906567548650191832090823482852604346478335353784501076761922605361848703623</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">4508246168044513518452493882713536390636741541551805821790338973797615971271867248584379813114125478195284692695928668946553625483179633266057122967547052</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">23383087478545512218713157932934746110721706819077423418060220083657713428503582801909807142802647367994289775015595100541168367083097506193809451365010723</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">22966105670291282335588843018244161552764486373117942865966904076191122337435542553276743938817686729554714315494818922753880198945897222422137268427611672</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">31775649089861428671057909076144152870796722528112580479442073365053916012507273433028451755436987054722496057749731758475958301164082755003195632005308493</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">17963313063405045742968136916219838352135561785389534381262979264585397896844470879023686508540355160998533122970239261072020689217153126649390825646712087</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">22246342022943432820696190444155665289928378653841172632283227888174495402248633061010615572642126584591103750338919213945646074833823905521643025879053949</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">1652417534709029450380570653973705320986117679597563873022683140800507482560482948310131540948227797045505390333146191586749269249548168247316404074014639</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">25395461142670631268156106136028325744393358436617528677967249347353524924655001151849544022201772500033280822372661344352607434738696051779095736547813043</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">15585771734488351039456631394040497759568679429510619219766191780807675361741859290490732451112648776648126779759368428205194684721516497026290981786239352</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">32056508892744184901289413287728039891303832311548608141088227876326753674154124775132776928481935378184756756785107540781632570295330486738268173167809047</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">8965123421637694050044216844523379163347478029124815032832813225050732558524239660648746284884140746788823681886010577342254841014594570067467905682359797</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">52849766269541827474228189428820648574162539595985395992261649809907435742263020551050064268890333392877173572811691599841253150460219986817964461970736553</span>&#125;,</span><br><span class="line">&#123;<span class="string">"c"</span>: <span class="number">13560945756543023008529388108446940847137853038437095244573035888531288577370829065666320069397898394848484847030321018915638381833935580958342719988978247</span>, <span class="string">"e"</span>: <span class="number">10</span>, <span class="string">"n"</span>: <span class="number">30415984800307578932946399987559088968355638354344823359397204419191241802721772499486615661699080998502439901585573950889047918537906687840725005496238621</span>&#125;]</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> session <span class="keyword">in</span> sessions:</span><br><span class="line">    e=session[<span class="string">'e'</span>]</span><br><span class="line">    n=session[<span class="string">'n'</span>]</span><br><span class="line">    msg=session[<span class="string">'c'</span>]</span><br><span class="line">    data = data + [(msg, n)]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Please wait, performing CRT"</span></span><br><span class="line">x, n = chinese_remainder_theorem(data)</span><br><span class="line">e=session[<span class="string">'e'</span>]</span><br><span class="line">realnum = gmpy.mpz(x).root(e)[<span class="number">0</span>].digits()</span><br><span class="line"><span class="keyword">print</span> my_parse_number(int(realnum))</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="低解密指数攻击"><a href="#低解密指数攻击" class="headerlink" title="低解密指数攻击"></a>低解密指数攻击</h1><p>与低加密指数相同，低解密指数可以加快解密的过程，但是相对的也带来了安全问题。</p>
<h2 id="1-Wiener攻击"><a href="#1-Wiener攻击" class="headerlink" title="1.Wiener攻击"></a>1.Wiener攻击</h2><p>在RSA系统中，如果以下条件满足：<br>$$q &lt; p &lt; 2q$$<br>且<br>$$d &lt; n^{1/4}$$<br>那么我们就可以利用连分数的渐进分数攻击得到d</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/1.jpg" alt="1"></div><br><div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/2.jpg" alt="2"></div>

<p>利用脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.all <span class="keyword">import</span> continued_fraction, Integer, inverse_mod</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wiener</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    q0 = <span class="number">1</span></span><br><span class="line">    M = <span class="number">1333337</span></span><br><span class="line">    C = pow(M, e, n)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> continued_fraction(Integer(e) / Integer(n)).convergents():</span><br><span class="line">        q1 = int(x.denominator())</span><br><span class="line">        <span class="comment"># see Andrej Dujella. "A variant of Wiener’s attack on RSA"</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                d = r*q1 + s*q0</span><br><span class="line">                <span class="keyword">if</span> pow(C, d, n) == M:</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line">        q0 = q1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = xxx</span><br><span class="line">n = xxx</span><br><span class="line">d = wiener(e, n)</span><br></pre></td></tr></table></figure></p>
<h3 id="例题-ASIS-CTF-Finals-2017-Gracias"><a href="#例题-ASIS-CTF-Finals-2017-Gracias" class="headerlink" title="例题:ASIS-CTF-Finals-2017 Gracias"></a>例题:ASIS-CTF-Finals-2017 Gracias</h3><p>题目给了类似RSA的算法的公钥和密文，并且脚本中可以发现是先生成比较小的d再生成的e。同时n是由三个质数相乘生成的，不过并不影响使用wiener攻击。<br>解题脚本如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.all <span class="keyword">import</span> continued_fraction, Integer, inverse_mod</span><br><span class="line"></span><br><span class="line">pubkey = (<span class="number">1696852658826990842058316561963467335977986730245296081842693913454799128341723605666024757923000936875008280288574503060506225324560725525210728761064310034604441130912702077320696660565727540525259413564999213382434231194132697630244074950529107794905761549606578049632101483460345878198682237227139704889943489709170676301481918176902970896183163611197618458670928730764124354693594769219086662173889094843054787693685403229558143793832013288487194871165461567L</span>, <span class="number">814161885590044357190593282132583612817366020133424034468187008267919006610450334193936389251944312061685926620628676079561886595567219325737685515818965422518820810326234612624290774570873983198113409686391355443155606621049101005048872030700143084978689888823664771959905075795440800042648923901406744546140059930315752131296763893979780940230041254506456283030727953969468933552050776243515721233426119581636614777596169466339421956338478341355508343072697451L</span>, <span class="number">171012227587318507773834753911094468358648971527111097308935888531930900156798659257578479378777764146070352809723708236353390208094909385240006920137781562826981091183813955039359863361624869703055918575613667858215532572602435432258750639197322091887713402631456113333645709142822182724397962837201266977523L</span>, <span class="number">96969753191136466007366303619618019752521508403657426306543836447071659732926802256183021740376016065813234292694535879838415771865207311953800116203362150588941093508091412441933752168889516206420588410478242229762908362637083786338280959547015086176046206126019992386890758970740552952647510652431386064722L</span>)</span><br><span class="line">c=(<span class="number">1569733526826523065259704222721381245770313117205865099913421859731162526943498524936251685846967970606251353344665893442015804015671457823645874503670136308040791285744658847419176471348768113798503897694020110157476679833746227801224812046930570487233225157924912272791212802495997329083436189937249314855532400635293522270501567950040825794060896420481676398789310029592608176167251882124182145471818654414925639589921023176070657483148482403065241178276749773L</span>, <span class="number">139537660044872985880471632333334179976891152860359271230202507995985566816703080930428310461057387079799847266510420206696052591677854190150642820963140050439023069266243433278700748622126726137374130247097863526461696642750021196138340072411724739383716017406022211953417323065831672315854246554523225039827L</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wiener</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    q0 = <span class="number">1</span></span><br><span class="line">    M = <span class="number">1333337</span></span><br><span class="line">    C = pow(M, e, n)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> continued_fraction(Integer(e) / Integer(n)).convergents():</span><br><span class="line">        q1 = int(x.denominator())</span><br><span class="line">        <span class="comment"># see Andrej Dujella. "A variant of Wiener’s attack on RSA"</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                d = r*q1 + s*q0</span><br><span class="line">                <span class="keyword">if</span> pow(C, d, n) == M:</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line">        q0 = q1</span><br><span class="line"></span><br><span class="line">n, e, a, g = pubkey</span><br><span class="line">c1, c2 = c</span><br><span class="line"></span><br><span class="line">d = wiener(e, n)</span><br><span class="line"><span class="comment"># d = 100556095937036905102538523179832446199526507742826168666218687736467897968451</span></span><br><span class="line">k = pow(c1, d, n)</span><br><span class="line">K = pow(g, k, a)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'&#123;:x&#125;'</span>.format(c2 * inverse_mod(K, a) % a).decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure></p>
<p>并且这道题也可以用<a href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage" target="_blank" rel="noopener">Boneh-Durfee attack</a>做，脚本如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.all <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># Original: https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</span></span><br><span class="line"></span><br><span class="line">dimension_min = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_unhelpful</span><span class="params">(BB, monomials, bound, current)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> current == <span class="number">-1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line">  <span class="keyword">for</span> ii <span class="keyword">in</span> range(current, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">    <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">      affected_vectors = <span class="number">0</span></span><br><span class="line">      affected_vector_index = <span class="number">0</span></span><br><span class="line">      <span class="keyword">for</span> jj <span class="keyword">in</span> range(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">          affected_vectors += <span class="number">1</span></span><br><span class="line">          affected_vector_index = jj</span><br><span class="line">      <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#print "* removing unhelpful vector", ii</span></span><br><span class="line">        BB = BB.delete_columns([ii])</span><br><span class="line">        BB = BB.delete_rows([ii])</span><br><span class="line">        monomials.pop(ii)</span><br><span class="line">        BB = remove_unhelpful(BB, monomials, bound, ii<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line">      <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">        affected_deeper = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> range(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">          <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">            affected_deeper = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> abs(bound - BB[affected_vector_index, affected_vector_index]) &lt; abs(bound - BB[ii, ii]):</span><br><span class="line">          <span class="comment">#print "* removing unhelpful vectors", ii, "and", affected_vector_index</span></span><br><span class="line">          BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">          BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">          monomials.pop(affected_vector_index)</span><br><span class="line">          monomials.pop(ii)</span><br><span class="line">          BB = remove_unhelpful(BB, monomials, bound, ii<span class="number">-1</span>)</span><br><span class="line">          <span class="keyword">return</span> BB</span><br><span class="line">  <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boneh_durfee_small_roots</span><span class="params">(pol, modulus, mm, tt, XX, YY)</span>:</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> range(mm + <span class="number">1</span>):</span><br><span class="line">      <span class="keyword">for</span> ii <span class="keyword">in</span> range(mm - kk + <span class="number">1</span>):</span><br><span class="line">        xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">        gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">      <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">        <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">          monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> range(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">      <span class="keyword">for</span> kk <span class="keyword">in</span> range(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">        yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">        yshift = Q(yshift).lift()</span><br><span class="line">        gg.append(yshift)</span><br><span class="line">        monomials.append(u^kk * y^jj)</span><br><span class="line">    nn = len(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> range(nn):</span><br><span class="line">      BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">for</span> jj <span class="keyword">in</span> range(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">          BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line">    BB = remove_unhelpful(BB, monomials, modulus^mm, nn<span class="number">-1</span>)</span><br><span class="line">    nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"failure"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line">    PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">    pol1 = pol2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> range(nn):</span><br><span class="line">      pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[<span class="number">0</span>, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">      pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[<span class="number">1</span>, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">    PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">    rr = pol1.resultant(pol2)</span><br><span class="line">    <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"the two first vectors are not independant"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    rr = rr(q, q)</span><br><span class="line">    soly = rr.roots()</span><br><span class="line">    <span class="keyword">if</span> len(soly) == <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"Your prediction (delta) is too small"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boneh_durfee</span><span class="params">(n, e)</span>:</span></span><br><span class="line">  delta = RR(<span class="number">0.167</span>) <span class="comment"># d ~ n^0.167</span></span><br><span class="line">  m = <span class="number">5</span></span><br><span class="line">  t = round((<span class="number">1</span><span class="number">-2</span>*delta) * m)</span><br><span class="line">  X = ZZ(<span class="number">2</span>*floor(n^delta))</span><br><span class="line">  <span class="comment"># we have n = p^2q. so `phi(n) = n + &#123;-(pq+pr+qr) + p+q+r)&#125; - 1`.</span></span><br><span class="line">  <span class="comment"># we reconsidered boneh-durfee's attack then we have `x(A+y) + 1 = 0 mod e` where `A = (n-1)`</span></span><br><span class="line">  <span class="comment"># and (x, y) = (k, -(pq+pr+qr)+p+q+r). </span></span><br><span class="line">  Y = ZZ(floor(n^(<span class="number">2</span>/<span class="number">3</span>)))</span><br><span class="line">  P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">  A = ZZ((n<span class="number">-1</span>)/<span class="number">2</span>)</span><br><span class="line">  pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line">  solx, soly = boneh_durfee_small_roots(pol, e, m, t, X, Y)</span><br><span class="line">  <span class="keyword">print</span> solx, soly</span><br><span class="line">  <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> int(pol(solx, soly) / e)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">  N = <span class="number">1696852658826990842058316561963467335977986730245296081842693913454799128341723605666024757923000936875008280288574503060506225324560725525210728761064310034604441130912702077320696660565727540525259413564999213382434231194132697630244074950529107794905761549606578049632101483460345878198682237227139704889943489709170676301481918176902970896183163611197618458670928730764124354693594769219086662173889094843054787693685403229558143793832013288487194871165461567</span></span><br><span class="line">  e = <span class="number">814161885590044357190593282132583612817366020133424034468187008267919006610450334193936389251944312061685926620628676079561886595567219325737685515818965422518820810326234612624290774570873983198113409686391355443155606621049101005048872030700143084978689888823664771959905075795440800042648923901406744546140059930315752131296763893979780940230041254506456283030727953969468933552050776243515721233426119581636614777596169466339421956338478341355508343072697451</span></span><br><span class="line">  <span class="keyword">print</span> boneh_durfee(N, e)</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="选择密文攻击"><a href="#选择密文攻击" class="headerlink" title="选择密文攻击"></a>选择密文攻击</h1><p>在这类攻击中我们可以传给服务器不同的密文，并且得到一些回复。通过这些回复以及已知信息可以破译明文</p>
<h2 id="1-Bit-Oracle-Attack"><a href="#1-Bit-Oracle-Attack" class="headerlink" title="1.Bit Oracle Attack"></a>1.Bit Oracle Attack</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>假设用户知道N，e，c，并且可以构造任意密文c1，返回此密文解密后p1的末尾的某些比特的性质(记为函数f)，最常见的函数f就是表示p1的奇偶性</p>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>攻击者得到密文<br>$$ C = P^e mod (n)$$<br>将其乘以<br>$$ 2^e mod (n) $$<br>并作为密文发送过去，并且返回f(2P)</p>
<blockquote>
<p>如果f(2P)返回的最后一位是0，那么2P &lt; N，即P &lt; N/2<br>如果f(2P)返回的最后一位是1，那么2P &gt; N，即P &gt; N/2</p>
</blockquote>
<p>接下来我们来看看2P和4P</p>
<blockquote>
<p>如果返回的是（偶，偶），那么有P &lt; N/4<br>如果返回的是（偶，奇），那么有N/4 &lt; P &lt; N/2<br>如果返回的是（奇，偶），那么有N/2 &lt; P &lt; N/4<br>如果返回的是（奇，奇），那么有3N/4 &lt; P &lt; N<br>可以发现规律：P的所在空间回不断的缩小，我们可以通过这种方法得到P</p>
</blockquote>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>$$ C’ = (2^e mod(N))*C $$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Oracle(C<span class="string">') == even)</span></span><br><span class="line"><span class="string">    UB = (UB + LB)/2;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    LB = (UB + LB)/2;</span></span><br></pre></td></tr></table></figure>
<h3 id="例题-XCTF-4th-QCTF-2018-babyrsa"><a href="#例题-XCTF-4th-QCTF-2018-babyrsa" class="headerlink" title="例题:XCTF 4th-QCTF-2018 babyrsa"></a>例题:XCTF 4th-QCTF-2018 babyrsa</h3><p>题目给了如下信息:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nc <span class="number">111.198</span><span class="number">.29</span><span class="number">.45</span> <span class="number">31954</span></span><br></pre></td></tr></table></figure></p>
<p>nc过去之后会有如下返回：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">----------------------------- baby rsa -----------------------------</span><br><span class="line">Come and Decode your data</span><br><span class="line">If you give me ciphertext, I can tell you whether decoded data is even or odd</span><br><span class="line">You can input ciphertext(hexdecimal) now</span><br><span class="line">1</span><br><span class="line">odd</span><br></pre></td></tr></table></figure></p>
<p>也就是它可以解密我们传过去的密文并且告诉解密之后的信息是奇数还是偶数</p>
<p>解题脚本如下(由于我自己写的脚本一直有问题，就借鉴了<a href="http://www.cnblogs.com/semishigure/p/9318258.html" target="_blank" rel="noopener">别的大佬的脚本</a>)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getevenOrodd</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="string">"""nc连接获取even or odd"""</span></span><br><span class="line">    adress = <span class="string">"111.198.29.45"</span></span><br><span class="line">    port = <span class="number">31954</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((adress, int(port)))</span><br><span class="line">    s.recv(<span class="number">1024</span>)</span><br><span class="line">    data = hex(c)[:<span class="number">-1</span>] + <span class="string">"\n"</span></span><br><span class="line">    s.send(data)</span><br><span class="line">    codeindex = s.recv(<span class="number">1024</span>)</span><br><span class="line">    s.shutdown(<span class="number">1</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">print</span> codeindex</span><br><span class="line">    <span class="keyword">return</span> codeindex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(n)</span>:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    LB = <span class="number">0</span></span><br><span class="line">    UB = n</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    c = int(<span class="string">"0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0"</span>,<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">while</span> LB != UB:</span><br><span class="line">	<span class="keyword">print</span> count</span><br><span class="line">        c1 = (pow(<span class="number">2</span>, e, n) * c) % n</span><br><span class="line">	<span class="keyword">print</span> UB-LB</span><br><span class="line">        <span class="keyword">if</span> getevenOrodd(c1)[:<span class="number">-1</span>] == <span class="string">"even"</span>:</span><br><span class="line">            UB = (UB + LB) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            LB = (UB + LB) / <span class="number">2</span></span><br><span class="line">        c = c1</span><br><span class="line">	count +=<span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> LB</span><br><span class="line"></span><br><span class="line">n=int(<span class="string">"0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db"</span>,<span class="number">16</span>)</span><br><span class="line">decrypt(n)</span><br><span class="line"></span><br><span class="line">LB = <span class="number">560856645743734814774953158390773525781916094468093308691660509501812320</span></span><br><span class="line">plaintext = binascii.unhexlify(hex(LB)[<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">print(plaintext)</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="Coppersmith-相关攻击"><a href="#Coppersmith-相关攻击" class="headerlink" title="Coppersmith 相关攻击"></a>Coppersmith 相关攻击</h1><p><a href="https://github.com/mimoo/RSA-and-LLL-attacks" target="_blank" rel="noopener">参考资料</a></p>
<h2 id="1-Factoring-with-High-Bits-Known"><a href="#1-Factoring-with-High-Bits-Known" class="headerlink" title="1.Factoring with High Bits Known"></a>1.Factoring with High Bits Known</h2><h3 id="攻击原理"><a href="#攻击原理" class="headerlink" title="攻击原理"></a>攻击原理</h3><p>待补充(等我好好学学数论orz)</p>
<h3 id="攻击条件"><a href="#攻击条件" class="headerlink" title="攻击条件"></a>攻击条件</h3><p>当我们知道一个公钥中模数 N 的一个因子的较高位时，我们就有一定几率来分解 N。</p>
<h3 id="例题-WHCTF-2017-Untitled"><a href="#例题-WHCTF-2017-Untitled" class="headerlink" title="例题:WHCTF-2017 Untitled"></a>例题:WHCTF-2017 Untitled</h3><p>WP参考<a href="https://cloud.tencent.com/developer/article/1038263" target="_blank" rel="noopener">此篇文章</a></p>
<p>题目给了服务器端代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,long_to_bytes,bytes_to_long</span><br><span class="line"><span class="keyword">import</span> primefac</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Unbuffered</span><span class="params">(object)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, stream)</span>:</span></span><br><span class="line">       self.stream = stream</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, data)</span>:</span></span><br><span class="line">       self.stream.write(data)</span><br><span class="line">       self.stream.flush()</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> getattr(self.stream, attr)</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.stdout = Unbuffered(sys.stdout)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_args</span><span class="params">()</span>:</span></span><br><span class="line">    p=getPrime(<span class="number">1024</span>)</span><br><span class="line">    q=getPrime(<span class="number">1024</span>)</span><br><span class="line">    n=p*q</span><br><span class="line">    e=<span class="number">0x10001</span></span><br><span class="line">    d=primefac.modinv(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))%((p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">return</span> (p,q,e,n,d)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span><span class="params">()</span>:</span></span><br><span class="line">    salt=urandom(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">print</span> salt.encode(<span class="string">"base64"</span>),</span><br><span class="line">    proof=raw_input(<span class="string">"show me your work: "</span>)</span><br><span class="line">    <span class="keyword">if</span> hashlib.md5(salt+proof.decode(<span class="string">"base64"</span>)).hexdigest().startswith(<span class="string">"0000"</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"checked success"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof():</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    m=int(open(<span class="string">"/home/bibi/PycharmProjects/work/whctf/flag"</span>,<span class="string">"r"</span>).read().encode(<span class="string">"hex"</span>),<span class="number">16</span>)<span class="comment">#flag&#123;*&#125;</span></span><br><span class="line">    (p,q,e,n,d)=gen_args()</span><br><span class="line">    c=pow(m,e,n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"n:"</span>,hex(n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"e:"</span>,hex(e)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"c:"</span>,hex(c)</span><br><span class="line">    t=int(hex(m)[<span class="number">2</span>:][<span class="number">0</span>:<span class="number">8</span>],<span class="number">16</span>)</span><br><span class="line">    u=pow(t,e,n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"u:"</span>,hex(u)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"===="</span></span><br><span class="line">    x=int(hex(m)[<span class="number">2</span>:][<span class="number">0</span>:<span class="number">8</span>]+raw_input(<span class="string">"x: "</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"===="</span></span><br><span class="line">    y=int(raw_input(<span class="string">"y: "</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> (pow(x,e,n)==y <span class="keyword">and</span> pow(y,d,n)==t):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"s:"</span>,hex(int(bin(p)[<span class="number">2</span>:][<span class="number">0</span>:<span class="number">568</span>],<span class="number">2</span>))</span><br><span class="line">run()</span><br></pre></td></tr></table></figure></p>
<p>第一部分是工作量证明<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span><span class="params">()</span>:</span></span><br><span class="line">    salt=urandom(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">print</span> salt.encode(<span class="string">"base64"</span>),</span><br><span class="line">    proof=raw_input(<span class="string">"show me your work: "</span>)</span><br><span class="line">    <span class="keyword">if</span> hashlib.md5(salt+proof.decode(<span class="string">"base64"</span>)).hexdigest().startswith(<span class="string">"0000"</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"checked success"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>写个脚本爆破就行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">salt=p.recvline()</span><br><span class="line">msg = base64.b64decode(salt)</span><br><span class="line">work=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> count():</span><br><span class="line">    hashid = md5(msg+str(i)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> hashid.startswith(<span class="string">'0000'</span>):</span><br><span class="line">        <span class="comment">#print i,hashid</span></span><br><span class="line">        work=base64.b64encode(str(i))</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p>然后会进入系统，主要关注以下代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof():</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    m=int(open(<span class="string">"/home/bibi/PycharmProjects/work/whctf/flag"</span>,<span class="string">"r"</span>).read().encode(<span class="string">"hex"</span>),<span class="number">16</span>)<span class="comment">#flag&#123;*&#125;</span></span><br><span class="line">    (p,q,e,n,d)=gen_args()</span><br><span class="line">    c=pow(m,e,n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"n:"</span>,hex(n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"e:"</span>,hex(e)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"c:"</span>,hex(c)</span><br><span class="line">    t=int(hex(m)[<span class="number">2</span>:][<span class="number">0</span>:<span class="number">8</span>],<span class="number">16</span>) <span class="comment">#取hex(m)的前八位      t=1718378855</span></span><br><span class="line">    u=pow(t,e,n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"u:"</span>,hex(u)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"===="</span></span><br><span class="line">    x=int(hex(m)[<span class="number">2</span>:][<span class="number">0</span>:<span class="number">8</span>]+raw_input(<span class="string">"x: "</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"===="</span></span><br><span class="line">    y=int(raw_input(<span class="string">"y: "</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> (pow(x,e,n)==y <span class="keyword">and</span> pow(y,d,n)==t):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"s:"</span>,hex(int(bin(p)[<span class="number">2</span>:][<span class="number">0</span>:<span class="number">568</span>],<span class="number">2</span>))</span><br><span class="line">run()</span><br></pre></td></tr></table></figure></p>
<p>我们可以输入X为空字符，Y为u，就可以得到s(官方WP说这也是他们出题失误导致可以这么做hhhh)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"> </span><br><span class="line">p=remote(<span class="string">'118.31.18.75'</span>,<span class="number">20013</span>)</span><br><span class="line"> </span><br><span class="line">salt=p.recvline()</span><br><span class="line">msg = base64.b64decode(salt)</span><br><span class="line">work=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> count():</span><br><span class="line">    hashid = md5(msg+str(i)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> hashid.startswith(<span class="string">'0000'</span>):</span><br><span class="line">        <span class="comment">#print i,hashid</span></span><br><span class="line">        work=base64.b64encode(str(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment">#print work</span></span><br><span class="line">t=<span class="number">1718378855</span></span><br><span class="line">p.recvuntil(<span class="string">'work: '</span>)</span><br><span class="line">p.sendline(work)</span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br><span class="line">u = int(p.recvline()[<span class="number">5</span>:<span class="number">-2</span>],<span class="number">16</span>)   <span class="comment">#u</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"u:"</span>,hex(u)</span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br><span class="line">p.recvuntil(<span class="string">'x: '</span>)</span><br><span class="line"><span class="comment">#print str(hex(t))</span></span><br><span class="line">p.sendline(<span class="string">""</span>)  <span class="comment">#x</span></span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br><span class="line">p.recvuntil(<span class="string">'y: '</span>)  <span class="comment">#y</span></span><br><span class="line">p.sendline(str(hex(u))[<span class="number">2</span>:])</span><br><span class="line"><span class="comment"># p_568=int(p.recvline()[5:-2],16)</span></span><br><span class="line"><span class="comment"># print "p_568:",hex(p_568)</span></span><br><span class="line"><span class="keyword">print</span> p.recvline()</span><br></pre></td></tr></table></figure></p>
<p>之后我们得到s，是p的前568位二进制数组成的数，这里有个小坑，直接拿去高位攻击是不行的，因为必须要已知576位才能高位攻击，所以我们要爆破568到576中的八位二进制数即两位十六进制然后再进行已知高位攻击，直接放sage代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.all <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">n =   <span class="number">0x9d3a1a28ecb1bd245dd86b18dc4c5b729f23778710005118836129f08e31d6516de8ab47db1b3b7f660f50d283b1e9f2c06e7836136e4c0159f5d2b05771861d3ce6aa8715932eadc1cc0f380909a1961018340f7393142f9c177b1187151f97ac8cdc4ad17fa59a0f39d192af555f27de9cc800846eb2ca6ce78f87c0c0fbf47828328392b81771af624389fd779d130d80739bb7a608961125ba3f1800c766440fa70bfd3f834294d47d7ed9cfffd6d14ae18310f6c1d6d8f88b6c5d72a0b45608b4e21bbb8e314220ed7a2d6a8c95454e571c71b50f1d6a823778ca47131f5b889a1ed1957248bee8c4ac66872a5fd58a121560a27bad4958f1c763f2ffddL</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">cipher = <span class="number">0x1f2deea59244b14e53c72465febc2064172a35245842fa83ebff313344bed35ee8af8c3f8f61e6f498fa1fd35e63998a573d7717905f72ec01de0b0529eaab10eb0b0c2ca06e9d6e4245e748fd74f4f756a86e379559793389a3ae6c421d51bb78331a487fc3c3e68971e3e26991ab34ce2a2c07ffd5a5a1e215e766b51fb2d6aab63c2dafa3c87d0a5eb79b634740e1fca7a727de997958839bda684e19acad93cae4abfd1c8cc3684419f83696fe4840f3253e7c038adb13a1382667cf7e17ef55c1e950ea474594102e660e36a23bfd3fd830d1c18a434d0b34bed98308399a894dcab909d68bcab7c7ac990974a4f6ed7d612abb7044f6734eaaebcdc0b5L</span></span><br><span class="line"> </span><br><span class="line">e2 = <span class="number">0x10001</span></span><br><span class="line">pbits = <span class="number">1024</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">127</span>):</span><br><span class="line">    p4=<span class="number">0xda5df16f286dbc825cd0c8ee48aa26ac27338a75172c5b92351f14d083216f7e91b9355e27cf930646fbbda6058dec3c4ddf751f36df5556359fbe671f9b947b4c79cadfdbb27b00</span></span><br><span class="line">    p4=p4+int(hex(i),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">print</span> hex(p4)</span><br><span class="line">    kbits = pbits - p4.nbits()  <span class="comment">#未知需要爆破的比特位数</span></span><br><span class="line">    <span class="keyword">print</span> p4.nbits()</span><br><span class="line">    p4 = p4 &lt;&lt; kbits</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = x + p4</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>) <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="comment">#rint roots</span></span><br><span class="line">  <span class="keyword">if</span> roots:        <span class="comment">#爆破成功，求根</span></span><br><span class="line">        p = p4+int(roots[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"p: "</span>, hex(int(p))</span><br><span class="line">        <span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">        q = n/int(p)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"q: "</span>, hex(int(q))</span><br><span class="line">        <span class="keyword">print</span> gcd(p,q)</span><br><span class="line">        phin = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">print</span> gcd(e2,phin)</span><br><span class="line">        d = inverse_mod(e2,phin)</span><br><span class="line">        flag = pow(cipher,d,n)</span><br><span class="line">        flag = hex(int(flag))[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">print</span> binascii.unhexlify(flag)</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="侧信道攻击"><a href="#侧信道攻击" class="headerlink" title="侧信道攻击"></a>侧信道攻击</h1><p><a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_side_channel/" target="_blank" rel="noopener">参考资料</a></p>
<blockquote>
<p>能量分析攻击（侧信道攻击）是一种能够从密码设备中获取秘密信息的密码攻击方法．与其 他攻击方法不同：这种攻击利用的是密码设备的能量消耗特征，而非密码算法的数学特性．能量分析攻击是一种非入侵式攻击，攻击者可以方便地购买实施攻击所需要的设备：所以这种攻击对智能卡之类的密码设备的安全性造成了严重威胁。</p>
</blockquote>
<blockquote>
<p>能量分析攻击是安全领域内非常重要的一个部分，我们只在这里简单讨论下。</p>
</blockquote>
<blockquote>
<p>能量分析攻击分为： - 简单能量分析攻击（SPA），即对能量迹进行直观分析，肉眼看即可。 - 差分能量分析攻击（DPA），基于能量迹之间的相关系数进行分析。</p>
</blockquote>
<h2 id="攻击条件-1"><a href="#攻击条件-1" class="headerlink" title="攻击条件"></a>攻击条件</h2><p>攻击者可获取与加解密相关的侧信道信息，例如能量消耗、运算时间、电磁辐射等等</p>
<h2 id="例题-HITB-2017-Hack-in-the-card-I"><a href="#例题-HITB-2017-Hack-in-the-card-I" class="headerlink" title="例题:HITB-2017 Hack in the card I"></a>例题:HITB-2017 Hack in the card I</h2><p>题目给出了公钥文件 publickey.pem，密文，测量智能卡功率的电路图，和解密过程中智能卡消耗的功率变化（通过在线网站给出 trace）。</p>
<div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/3.png" alt="3"></div><br><div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/4.jpg" alt="4"></div>

<p>密文为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">014b05e1a09668c83e13fda8be28d148568a2342aed833e0ad646bd45461da2decf9d538c2d3ab245b272873beb112586bb7b17dc4b30f0c5408d8b03cfbc8388b2bd579fb419a1cac38798da1c3da75dc9a74a90d98c8f986fd8ab8b2dc539768beb339cadc13383c62b5223a50e050cb9c6b759072962c2b2cf21b4421ca73394d9e12cfbc958fc5f6b596da368923121e55a3c6a7b12fdca127ecc0e8470463f6e04f27cd4bb3de30555b6c701f524c8c032fa51d719901e7c75cc72764ac00976ac6427a1f483779f61cee455ed319ee9071abefae4473e7c637760b4b3131f25e5eb9950dd9d37666e129640c82a4b01b8bdc1a78b007f8ec71e7bad48046</span><br></pre></td></tr></table></figure></p>
<p>由于网站只给出了一条能量迹，所以可以断定这是 Simple channel analysis（SPA）攻击。那么我们可以直接通过观察能量迹的高低电平来获得 RSA 解密过程的密钥 d。 RSA 可被 SPA 攻击的理论基础来自于 RSA 中包含的快速幂取余算法。</p>
<p>快速幂算法如下<br>1.b为偶数时:<br>$$ a^b mod(c) = (a^{2^{b/2}} )mod(c) $$</p>
<p>2.b为奇数时：<br>$$ a^b mod(c) = (a^{2^{b/2}} \times a) mod(c) $$</p>
<p>相应的C代码实现为:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int PowerMod(int a, int b, int c)</span><br><span class="line">&#123;</span><br><span class="line">    int ans = <span class="number">1</span>;</span><br><span class="line">    a = a % c;</span><br><span class="line">    <span class="keyword">while</span>(b&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b % <span class="number">2</span> == <span class="number">1</span>) // 当b为奇数时会多执行下面的指令</span><br><span class="line">            ans = (ans * a) % c;</span><br><span class="line">        b = b/<span class="number">2</span>;</span><br><span class="line">        a = (a * a) % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由于快速幂的计算过程中会逐位判断指数的取值，并会采取不同的操作，所以可从能量迹中还原出 d 的取值（从上面可知，直接得到的值是 d 的二进制取值的<code>逆序</code>）</p>
<p>注意：</p>
<blockquote>
<p>有时候模乘也可能会从高位向低位进行模乘。这里是从低位向高位模乘。</p>
</blockquote>
<p>那么根据上面的说法，我们可以看出来能量迹高位的时候的长度不同，长的对应1，短的对应2，也就是如下图所示：</p>
<div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/5.jpg" alt="5"></div>

<p>我们可以通过这个信息还原d。</p>
<p>在给的能量迹的html中我们可以找到data数组，对应着能量迹的每一个点。其中前面的能量迹的点有波动可以不管，我们从稳定的位置开始分析即可，也就是<code>data[200]</code>之后</p>
<div style="width: 80%; margin: auto"><img src="/2019/01/09/RSA攻击综述/6.jpg" alt="6"></div>

<p>我们可以统计每一个高电平的点的数量.经过统计我们可以得到：100个点对应1，50个点对应0，则解题脚本如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">f = open(<span class="string">'./data.txt'</span>)</span><br><span class="line">data = f.read().split(<span class="string">","</span>)</span><br><span class="line"><span class="comment">#print('point number:', len(data))</span></span><br><span class="line"></span><br><span class="line">start_point = <span class="number">205</span></span><br><span class="line"></span><br><span class="line">lflag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">rflag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> point_index <span class="keyword">in</span> range(start_point, len(data)):</span><br><span class="line">    <span class="keyword">if</span> float(data[point_index]) &gt; <span class="number">225</span> <span class="keyword">and</span> flag == <span class="number">0</span>:</span><br><span class="line">            lflag = point_index</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> float(data[point_index]) &lt; <span class="number">225</span> <span class="keyword">and</span> flag == <span class="number">1</span>:</span><br><span class="line">            rflag = point_index</span><br><span class="line">            flag = <span class="number">0</span> </span><br><span class="line">            r = rflag - lflag</span><br><span class="line">            <span class="keyword">if</span> r &gt; <span class="number">75</span>:</span><br><span class="line">                res += <span class="string">'1'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res += <span class="string">'0'</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">out = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(res)):</span><br><span class="line">    data = res[len(res)-i<span class="number">-1</span>]</span><br><span class="line">    out += data</span><br><span class="line"><span class="comment">#print(out)</span></span><br><span class="line"></span><br><span class="line">d = int(out,<span class="number">2</span>)</span><br><span class="line">print(d)</span><br><span class="line">n = <span class="number">0x17AE4F9BD4FF06B94C46DCBB7070070C7C23C4E8728BE3173CA815FCA5471C0BB35B19ED8838530ABB27D69B1C9D87229D0658D807D8EF74D732576DF4FBA9CD611FC768BE6047C52E8168A1C77E0E54D4877DC20A73FC3A2DB35DDE8700E79BAF61676BF6B6B27032E6B9F3A02F3FAAAFF36251BF2935D9CB45EFAC13D0974484C3D53C2A66A3D279D2B1B594F3797C0B8D33409161F7293EECB5287F45DA104020F0215BCC824338AD4A316E25E4A167A6E4928AF122FA0A55C4E55DEE01A4E0EED89F4B290BF79B5CAFE797AE4FA4B369E043AA0DFE91487E9054FF843EA249ED7945C8A911796F81A0F82EB5694A2FE2EBFF13A9E6DF3334FCAA1C63CBAC3</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">e = '01:58:3f:58:ca:92:30:c4:f8:84:4c:7f:33:d6:19:83:c2:7b:f6:11:94:7a:1d:ce:39:00:73:03:88:05:17:5b:18:f2:45:54:3b:61:c6:ea:ab:46:a5:72:d0:34:26:47:6e:9a:ec:c3:47:16:cd:ac:9e:33:f0:31:f5:38:1d:18:cf:21:2a:81:91:f8:26:dd:10:e0:4f:db:50:6b:a9:fd:91:e4:83:1d:8a:dc:4c:75:aa:2a:a6:13:2e:7e:48:ea:c6:6d:7e:cf:24:42:82:95:eb:1b:7c:64:48:0c:f1:70:be:83:bc:d8:53:f9:77:9e:6d:f5:99:9c:2b:ee:f8:38:d2:f0:c4:d8:fc:4d:9c:8e:4c:6c:37:25:94:46:68:9e:c3:06:34:bc:d6:8f:29:3c:58:cd:44:03:9b:e6:29:9f:92:64:96:20:d6:e6:01:7d:fd:60:07:d1:bd:01:2d:f7:ca:be:c4:59:e0:e9:83:f1:7b:50:51:af:4a:4f:ca:5c:c7:1c:dd:72:a6:f4:80:8e:73:f8:33:91:7c:2f:54:80:1b:d9:a0:6e:35:99:ed:b9:a6:29:36:76:4c:e0:84:db:f5:55:c1:6f:9e:47:81:ea:d6:fd:39:79:24:76:c6:df:c0:dd:05:ad:a2:81:f7:51:11:ef:d7:52:80:65:d9:e3:5b'</span></span><br><span class="line"><span class="string">e = e.split(':')</span></span><br><span class="line"><span class="string">eout = ''</span></span><br><span class="line"><span class="string">for i in e:</span></span><br><span class="line"><span class="string">    eout +=i</span></span><br><span class="line"><span class="string">print(eout)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x01583f58ca9230c4f8844c7f33d61983c27bf611947a1dce390073038805175b18f245543b61c6eaab46a572d03426476e9aecc34716cdac9e33f031f5381d18cf212a8191f826dd10e04fdb506ba9fd91e4831d8adc4c75aa2aa6132e7e48eac66d7ecf24428295eb1b7c64480cf170be83bcd853f9779e6df5999c2beef838d2f0c4d8fc4d9c8e4c6c37259446689ec30634bcd68f293c58cd44039be6299f92649620d6e6017dfd6007d1bd012df7cabec459e0e983f17b5051af4a4fca5cc71cdd72a6f4808e73f833917c2f54801bd9a06e3599edb9a62936764ce084dbf555c16f9e4781ead6fd39792476c6dfc0dd05ada281f75111efd7528065d9e35b</span></span><br><span class="line">m = <span class="number">0X014b05e1a09668c83e13fda8be28d148568a2342aed833e0ad646bd45461da2decf9d538c2d3ab245b272873beb112586bb7b17dc4b30f0c5408d8b03cfbc8388b2bd579fb419a1cac38798da1c3da75dc9a74a90d98c8f986fd8ab8b2dc539768beb339cadc13383c62b5223a50e050cb9c6b759072962c2b2cf21b4421ca73394d9e12cfbc958fc5f6b596da368923121e55a3c6a7b12fdca127ecc0e8470463f6e04f27cd4bb3de30555b6c701f524c8c032fa51d719901e7c75cc72764ac00976ac6427a1f483779f61cee455ed319ee9071abefae4473e7c637760b4b3131f25e5eb9950dd9d37666e129640c82a4b01b8bdc1a78b007f8ec71e7bad48046</span> </span><br><span class="line">t = pow(m,d,n)</span><br><span class="line"><span class="comment">#t = '484954427b4d79206e616d6520697320416c6963652c20616e642074686973206973206d792073746f72792c2074686520656e64206f66206d792073746f72797d'</span></span><br><span class="line"><span class="keyword">print</span> hex(t)[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"># CTF</a>
          
            <a href="/tags/Crypto/" rel="tag"># Crypto</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/08/ethernautd训练/" rel="next" title="Ethernaut训练">
                <i class="fa fa-chevron-left"></i> Ethernaut训练
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/12/XNUCA-baby-crypto/" rel="prev" title="XNUCA-baby_crypto">
                XNUCA-baby_crypto <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Vergissmeinnicht">
          <p class="site-author-name" itemprop="name">Vergissmeinnicht</p>
           
              <p class="site-description motion-element" itemprop="description">Kap0k/De1ta/Crypto</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基本解法"><span class="nav-text">基本解法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#对模数n的因子分解"><span class="nav-text">对模数n的因子分解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-基本分解"><span class="nav-text">1.基本分解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Pollard-Rho"><span class="nav-text">2.Pollard Rho</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Pollard-P-1"><span class="nav-text">3.Pollard P-1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#例题-ASIS-CTF-Finals-2017-Handicraft-RSA"><span class="nav-text">例题:ASIS-CTF-Finals-2017 Handicraft_RSA</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-已知e-d分解n"><span class="nav-text">4.已知e,d分解n</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#例题-HITB-2017-Hack-in-the-card-II"><span class="nav-text">例题:HITB-2017 Hack in the card II</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#公共模数攻击"><span class="nav-text">公共模数攻击</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#低加密指数广播攻击"><span class="nav-text">低加密指数广播攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#例题-XCTF-4th-WHCTF-2017-OldDriver"><span class="nav-text">例题:XCTF 4th-WHCTF-2017 OldDriver</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#低解密指数攻击"><span class="nav-text">低解密指数攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Wiener攻击"><span class="nav-text">1.Wiener攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理"><span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例题-ASIS-CTF-Finals-2017-Gracias"><span class="nav-text">例题:ASIS-CTF-Finals-2017 Gracias</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#选择密文攻击"><span class="nav-text">选择密文攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Bit-Oracle-Attack"><span class="nav-text">1.Bit Oracle Attack</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#问题描述"><span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原理-1"><span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法"><span class="nav-text">方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例题-XCTF-4th-QCTF-2018-babyrsa"><span class="nav-text">例题:XCTF 4th-QCTF-2018 babyrsa</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Coppersmith-相关攻击"><span class="nav-text">Coppersmith 相关攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Factoring-with-High-Bits-Known"><span class="nav-text">1.Factoring with High Bits Known</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#攻击原理"><span class="nav-text">攻击原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#攻击条件"><span class="nav-text">攻击条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例题-WHCTF-2017-Untitled"><span class="nav-text">例题:WHCTF-2017 Untitled</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#侧信道攻击"><span class="nav-text">侧信道攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#攻击条件-1"><span class="nav-text">攻击条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例题-HITB-2017-Hack-in-the-card-I"><span class="nav-text">例题:HITB-2017 Hack in the card I</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vergissmeinnicht</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Gemini
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
